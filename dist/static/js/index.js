(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{135:function(t,e,a){"use strict";a.r(e),function(t){var e=a(57),i=a(58),o=a.n(i),n=(a(220),a(132)),s=a.n(n),r=a(133),c=a.n(r),u=a(134);a(221),a(224);function d(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return l(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return l(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,i=new Array(e);a<e;a++)i[a]=t[a];return i}function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function h(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var v=new s.a;var p=function(){function t(){var e=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=a.speed,o=void 0===i?50:i,n=a.voice,s=void 0===n?50:n,r=a.pitch,c=void 0===r?50:r,u=a.voiceName,l=void 0===u?"xiaoyan":u,h=a.appId,p=void 0===h?"5f39eb1b":h,y=a.text,m=void 0===y?"":y,w=a.tte,b=void 0===w?"UTF8":w,S=a.defaultText,g=void 0===S?"请输入您要合成的文本":S;f(this,t),this.speed=o,this.voice=s,this.pitch=c,this.voiceName=l,this.text=m,this.tte=b,this.defaultText=g,this.appId=p,this.audioData=[],this.rawAudioData=[],this.audioDataOffset=0,this.status="init",v.onmessage=function(t){var a,i;(a=e.audioData).push.apply(a,d(t.data.data)),(i=e.rawAudioData).push.apply(i,d(t.data.rawAudioData))}}var e,a,i;return e=t,(a=[{key:"setStatus",value:function(t){this.onWillStatusChange&&this.onWillStatusChange(this.status,t),this.status=t}},{key:"setParams",value:function(t){var e=t.speed,a=t.voice,i=t.pitch,o=t.text,n=t.voiceName,s=t.tte;void 0!==e&&(this.speed=e),void 0!==a&&(this.voice=a),void 0!==i&&(this.pitch=i),o&&(this.text=o),s&&(this.tte=s),n&&(this.voiceName=n),this.resetAudio()}},{key:"connectWebSocket",value:function(){var t=this;return this.setStatus("ttsing"),new Promise((function(t,e){var a="wss://tts-api.xfyun.cn/v2/tts",i=location.host,n=(new Date).toGMTString(),s="host: ".concat(i,"\ndate: ").concat(n,"\nGET /v2/tts HTTP/1.1"),r=o.a.HmacSHA256(s,"9c3916743d0f01f621ac8855cce70f95"),c=o.a.enc.Base64.stringify(r),u='api_key="'.concat("641f188a31e1b133adeba30979646886",'", algorithm="').concat("hmac-sha256",'", headers="').concat("host date request-line",'", signature="').concat(c,'"'),d=btoa(u);t(a="".concat(a,"?authorization=").concat(d,"&date=").concat(n,"&host=").concat(i))})).then((function(e){var a;if("WebSocket"in window)a=new WebSocket(e);else{if(!("MozWebSocket"in window))return void alert("浏览器不支持WebSocket");a=new MozWebSocket(e)}t.ttsWS=a,a.onopen=function(e){t.webSocketSend(),t.playTimeout=setTimeout((function(){t.audioPlay()}),1e3)},a.onmessage=function(e){t.result(e.data)},a.onerror=function(a){clearTimeout(t.playTimeout),t.setStatus("errorTTS"),alert("WebSocket报错，请f12查看详情"),console.error("详情查看：".concat(encodeURI(e.replace("wss:","https:"))))},a.onclose=function(t){console.log(t)}}))}},{key:"transToAudioData",value:function(t){}},{key:"webSocketSend",value:function(){var t={common:{app_id:this.appId},business:{aue:"raw",auf:"audio/L16;rate=16000",vcn:this.voiceName,speed:this.speed,volume:this.voice,pitch:this.pitch,bgs:1,tte:this.tte},data:{status:2,text:this.encodeText(this.text||this.defaultText,"unicode"===this.tte?"base64&utf16le":"")}};this.ttsWS.send(JSON.stringify(t))}},{key:"encodeText",value:function(t,e){switch(e){case"utf16le":for(var a=new ArrayBuffer(4*t.length),i=new Uint16Array(a),o=0,n=t.length;o<n;o++)i[o]=t.charCodeAt(o);return a;case"buffer2Base64":for(var s="",r=new Uint8Array(t),c=r.byteLength,d=0;d<c;d++)s+=String.fromCharCode(r[d]);return window.btoa(s);case"base64&utf16le":return this.encodeText(this.encodeText(t,"utf16le"),"buffer2Base64");default:return u.Base64.encode(t)}}},{key:"result",value:function(t){var e=JSON.parse(t);if(0!==e.code)return alert("合成失败: ".concat(e.code,":").concat(e.message)),console.error("".concat(e.code,":").concat(e.message)),void this.resetAudio();v.postMessage(e.data.audio),0===e.code&&2===e.data.status&&this.ttsWS.close()}},{key:"resetAudio",value:function(){this.audioStop(),this.setStatus("init"),this.audioDataOffset=0,this.audioData=[],this.rawAudioData=[],this.ttsWS&&this.ttsWS.close(),clearTimeout(this.playTimeout)}},{key:"audioInit",value:function(){var t=window.AudioContext||window.webkitAudioContext;t&&(this.audioContext=new t,this.audioContext.resume(),this.audioDataOffset=0)}},{key:"audioPlay",value:function(){var t=this;this.setStatus("play");var e=this.audioData.slice(this.audioDataOffset);this.audioDataOffset+=e.length;var a=this.audioContext.createBuffer(1,e.length,22050),i=a.getChannelData(0);if(a.copyToChannel)a.copyToChannel(new Float32Array(e),0,0);else for(var o=0;o<e.length;o++)i[o]=e[o];var n=this.bufferSource=this.audioContext.createBufferSource();n.buffer=a,n.connect(this.audioContext.destination),n.start(),n.onended=function(e){"play"===t.status&&(t.audioDataOffset<t.audioData.length?t.audioPlay():t.audioStop())}}},{key:"audioStop",value:function(){if(this.setStatus("endPlay"),clearTimeout(this.playTimeout),this.audioDataOffset=0,this.bufferSource)try{this.bufferSource.stop()}catch(t){console.log(t)}}},{key:"start",value:function(){if(this.audioData.length)this.audioPlay();else{if(this.audioContext||this.audioInit(),!this.audioContext)return void alert("该浏览器不支持webAudioApi相关接口");this.connectWebSocket()}}},{key:"stop",value:function(){this.audioStop()}}])&&h(e.prototype,a),i&&h(e,i),t}(),y=(new c.a,new p);y.onWillStatusChange=function(e,a){t(".audio-ctrl-btn").removeClass(e).addClass(a).text({init:"立即合成",ttsing:"正在合成",play:"停止播放",endPlay:"重新播放",errorTTS:"合成失败"}[a])},t(".ex-speaker").click((function(e){t(this).addClass("active"),t(this).siblings().removeClass("active");var a,i=t(this).attr("data-index");0==i?(a="正在为您查询西安的天气情况。今天是2020年8月24日，西安市今天多云，最低温度19摄氏度，最高温度32摄氏度，微风。",y.setParams({voiceName:"xiaoyan",tte:"unicode",text:a})):1==i?(a="正在为您查询西安的天气情况。今天是2020年8月24日，西安市今天多云，最低温度19摄氏度，最高温度32摄氏度，微风。",y.setParams({voiceName:"aisjiuxu",tte:"UTF8",text:a})):2==i?(a="正在为您查询西安的天气情况。今天是2020年8月24日，西安市今天多云，最低温度19摄氏度，最高温度32摄氏度，微风。",y.setParams({voiceName:"aisxping",tte:"UTF8",text:a})):3==i?(a="正在为您查询西安的天气情况。今天是2020年8月24日，西安市今天多云，最低温度19摄氏度，最高温度32摄氏度，微风。",y.setParams({voiceName:"aisjinger",tte:"UTF8",text:a})):4==i?(a="正在为您查询西安的天气情况。今天是2020年8月24日，西安市今天多云，最低温度19摄氏度，最高温度32摄氏度，微风。",y.setParams({voiceName:"aisbabyxu",tte:"UTF8",text:a})):5==i&&(a="正在为您查询西安的天气情况。今天是2020年8月24日，西安市今天多云，最低温度19摄氏度，最高温度32摄氏度，微风。",y.setParams({voiceName:"x2_yezi",tte:"UTF8",text:a})),t("#input_text").val(a)})),t(".audio-ctrl-btn").click((function(){["init","endPlay","errorTTS"].indexOf(y.status)>-1?y.start():y.stop()})),t(".download-wav").click((function(){y.rawAudioData.length?Object(e.b)(new DataView(new Int16Array(y.rawAudioData).buffer),16e3,16):alert("请先合成")})),t(".download-pcm").click((function(){y.rawAudioData.length?Object(e.a)(new Int16Array(y.rawAudioData)):alert("请先合成")})),t("#input_text").change((function(){y.setParams({text:this.value})}))}.call(this,a(136))},221:function(t,e,a){var i=a(222);"string"==typeof i&&(i=[[t.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};a(131)(i,o);i.locals&&(t.exports=i.locals)},222:function(t,e,a){},224:function(t,e,a){var i=a(225);"string"==typeof i&&(i=[[t.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};a(131)(i,o);i.locals&&(t.exports=i.locals)},225:function(t,e,a){}},[[226,3,2,0]]]);